<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="UserDAO">

    <!-- 아이디 중복 체크 -->
    <select id="selectCountByUserId" parameterType="string" resultType="int">
        SELECT COUNT(1)
        FROM   tb_user
        WHERE  user_id = #{userId}
    </select>



    <!-- 사용자 등록 (PostgreSQL) -->
    <insert id="insertUser" parameterType="biz.user.vo.UserVO">
        INSERT INTO tb_user (
            user_id, user_nm, user_password, email_adres, moblphon_no,user_sttus_cd,use_yn,jssfc_cd,
            register_id, regist_dt
        ) VALUES (
                     #{userId}, #{name}, #{password}, #{email}, #{phone},'NORMAL','Y',#{jssfcCd},
                     #{registerId}, NOW()
                 )
    </insert>

    <!-- 계정 목록 조회 -->
    <select id="selectUserList"
            parameterType="biz.user.vo.UserSearchCond"
            resultType="biz.user.vo.UserVO">

        SELECT u.user_id     AS userId
        , u.user_nm     AS name
        , u.moblphon_no AS phone
        , u.email_adres AS email
        , u.jssfc_cd    AS jssfcCd
        , u.regist_dt   AS registDt
        FROM tb_user u
        WHERE u.use_yn = 'Y'

        <!-- (여기에 기존 검색 조건들 그대로) -->
        <!-- option/keyword, jssfcCd, registMonth 조건들... -->

        ORDER BY u.regist_dt DESC
        LIMIT #{size} OFFSET #{offset}
    </select>

    <!-- 총 개수 -->
    <select id="countUserList"
            parameterType="biz.user.vo.UserSearchCond"
            resultType="int">

        SELECT COUNT(*)
        FROM tb_user u
        WHERE u.use_yn = 'Y'

        <!-- 위와 똑같은 검색 조건들 복붙 -->
    </select>


    <!-- 한 명 조회 -->
    <select id="selectUser" parameterType="string"
            resultType="biz.user.vo.UserVO">
        SELECT
            user_id      AS userId,
            user_nm      AS name,
            user_password AS password,
            email_adres  AS email,
            moblphon_no  AS phone,
            jssfc_cd     AS jssfcCd,
            register_id  AS registerId,
            regist_dt    AS registDt
        FROM tb_user
        WHERE user_id = #{userId}
    </select>

    <!-- 수정 -->
    <update id="updateUser" parameterType="biz.user.vo.UserVO">
        UPDATE tb_user
        SET
            user_password = #{password},
            user_nm       = #{name},
            email_adres   = #{email},
            moblphon_no   = #{phone}
        <if test="jssfcCd != null">
            , jssfc_cd = #{jssfcCd}
        </if>
        WHERE user_id = #{userId}
    </update>

    <delete id="deleteUser" parameterType="string">
        DELETE FROM tb_user
        WHERE user_id = #{userId}
    </delete>

<!--    이름으로 단건 조회-->
    <select id="findUserIdByName" parameterType="string"
            resultType="string">
        SELECT
            user_nm      AS name
        FROM tb_user
        WHERE user_nm = #{userName}
    </select>
</mapper>
